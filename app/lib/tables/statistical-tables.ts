export const T_TABLE_DF = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 40, 50, 60, 80, 100, 120, Infinity] as const;

export const T_TABLE_ALPHA_ONE_TAIL = [0.10, 0.05, 0.025, 0.01, 0.005, 0.001] as const;
export const T_TABLE_ALPHA_TWO_TAIL = [0.20, 0.10, 0.05, 0.02, 0.01, 0.002] as const;

export const T_CRITICAL_VALUES: Record<number, number[]> = {
  1: [3.078, 6.314, 12.706, 31.821, 63.657, 318.309],
  2: [1.886, 2.920, 4.303, 6.965, 9.925, 22.327],
  3: [1.638, 2.353, 3.182, 4.541, 5.841, 10.215],
  4: [1.533, 2.132, 2.776, 3.747, 4.604, 7.173],
  5: [1.476, 2.015, 2.571, 3.365, 4.032, 5.893],
  6: [1.440, 1.943, 2.447, 3.143, 3.707, 5.208],
  7: [1.415, 1.895, 2.365, 2.998, 3.499, 4.785],
  8: [1.397, 1.860, 2.306, 2.896, 3.355, 4.501],
  9: [1.383, 1.833, 2.262, 2.821, 3.250, 4.297],
  10: [1.372, 1.812, 2.228, 2.764, 3.169, 4.144],
  11: [1.363, 1.796, 2.201, 2.718, 3.106, 4.025],
  12: [1.356, 1.782, 2.179, 2.681, 3.055, 3.930],
  13: [1.350, 1.771, 2.160, 2.650, 3.012, 3.852],
  14: [1.345, 1.761, 2.145, 2.624, 2.977, 3.787],
  15: [1.341, 1.753, 2.131, 2.602, 2.947, 3.733],
  16: [1.337, 1.746, 2.120, 2.583, 2.921, 3.686],
  17: [1.333, 1.740, 2.110, 2.567, 2.898, 3.646],
  18: [1.330, 1.734, 2.101, 2.552, 2.878, 3.610],
  19: [1.328, 1.729, 2.093, 2.539, 2.861, 3.579],
  20: [1.325, 1.725, 2.086, 2.528, 2.845, 3.552],
  21: [1.323, 1.721, 2.080, 2.518, 2.831, 3.527],
  22: [1.321, 1.717, 2.074, 2.508, 2.819, 3.505],
  23: [1.319, 1.714, 2.069, 2.500, 2.807, 3.485],
  24: [1.318, 1.711, 2.064, 2.492, 2.797, 3.467],
  25: [1.316, 1.708, 2.060, 2.485, 2.787, 3.450],
  26: [1.315, 1.706, 2.056, 2.479, 2.779, 3.435],
  27: [1.314, 1.703, 2.052, 2.473, 2.771, 3.421],
  28: [1.313, 1.701, 2.048, 2.467, 2.763, 3.408],
  29: [1.311, 1.699, 2.045, 2.462, 2.756, 3.396],
  30: [1.310, 1.697, 2.042, 2.457, 2.750, 3.385],
  40: [1.303, 1.684, 2.021, 2.423, 2.704, 3.307],
  50: [1.299, 1.676, 2.009, 2.403, 2.678, 3.261],
  60: [1.296, 1.671, 2.000, 2.390, 2.660, 3.232],
  80: [1.292, 1.664, 1.990, 2.374, 2.639, 3.195],
  100: [1.290, 1.660, 1.984, 2.364, 2.626, 3.174],
  120: [1.289, 1.658, 1.980, 2.358, 2.617, 3.160],
  [Infinity]: [1.282, 1.645, 1.960, 2.326, 2.576, 3.090],
};

export function lookupTValue(df: number, alphaOneTail: number): number | null {
  const alphaIndex = T_TABLE_ALPHA_ONE_TAIL.indexOf(alphaOneTail as typeof T_TABLE_ALPHA_ONE_TAIL[number]);
  if (alphaIndex === -1) return null;

  let closestDf: number = T_TABLE_DF[0];
  for (const tableDf of T_TABLE_DF) {
    if (tableDf <= df) closestDf = tableDf;
    else break;
  }

  const row = T_CRITICAL_VALUES[closestDf];
  return row ? row[alphaIndex] : null;
}

export function findClosestDf(df: number): number {
  let closest: number = T_TABLE_DF[0];
  for (const tableDf of T_TABLE_DF) {
    if (tableDf === Infinity) {
      if (df >= 120) return Infinity;
      break;
    }
    if (tableDf <= df) closest = tableDf;
    else break;
  }
  return closest;
}

export const Z_TABLE_VALUES: number[][] = [];
export const Z_TABLE_ROWS = [-3.4, -3.3, -3.2, -3.1, -3.0, -2.9, -2.8, -2.7, -2.6, -2.5, -2.4, -2.3, -2.2, -2.1, -2.0, -1.9, -1.8, -1.7, -1.6, -1.5, -1.4, -1.3, -1.2, -1.1, -1.0, -0.9, -0.8, -0.7, -0.6, -0.5, -0.4, -0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.1, 3.2, 3.3, 3.4];
export const Z_TABLE_COLS = [0.00, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09];

function erf(x: number): number {
  const a1 = 0.254829592;
  const a2 = -0.284496736;
  const a3 = 1.421413741;
  const a4 = -1.453152027;
  const a5 = 1.061405429;
  const p = 0.3275911;

  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x);

  const t = 1.0 / (1.0 + p * x);
  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

  return sign * y;
}

export function normalCdf(z: number): number {
  return 0.5 * (1 + erf(z / Math.sqrt(2)));
}

for (const row of Z_TABLE_ROWS) {
  const rowValues: number[] = [];
  for (const col of Z_TABLE_COLS) {
    const z = row + (row >= 0 ? col : -col);
    rowValues.push(normalCdf(z));
  }
  Z_TABLE_VALUES.push(rowValues);
}

export function lookupZValue(z: number): number {
  return normalCdf(z);
}

export const CHI_SQUARE_DF = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 40, 50, 60, 70, 80, 90, 100] as const;

export const CHI_SQUARE_ALPHA = [0.995, 0.99, 0.975, 0.95, 0.90, 0.10, 0.05, 0.025, 0.01, 0.005] as const;

export const CHI_SQUARE_VALUES: Record<number, number[]> = {
  1: [0.000, 0.000, 0.001, 0.004, 0.016, 2.706, 3.841, 5.024, 6.635, 7.879],
  2: [0.010, 0.020, 0.051, 0.103, 0.211, 4.605, 5.991, 7.378, 9.210, 10.597],
  3: [0.072, 0.115, 0.216, 0.352, 0.584, 6.251, 7.815, 9.348, 11.345, 12.838],
  4: [0.207, 0.297, 0.484, 0.711, 1.064, 7.779, 9.488, 11.143, 13.277, 14.860],
  5: [0.412, 0.554, 0.831, 1.145, 1.610, 9.236, 11.070, 12.833, 15.086, 16.750],
  6: [0.676, 0.872, 1.237, 1.635, 2.204, 10.645, 12.592, 14.449, 16.812, 18.548],
  7: [0.989, 1.239, 1.690, 2.167, 2.833, 12.017, 14.067, 16.013, 18.475, 20.278],
  8: [1.344, 1.646, 2.180, 2.733, 3.490, 13.362, 15.507, 17.535, 20.090, 21.955],
  9: [1.735, 2.088, 2.700, 3.325, 4.168, 14.684, 16.919, 19.023, 21.666, 23.589],
  10: [2.156, 2.558, 3.247, 3.940, 4.865, 15.987, 18.307, 20.483, 23.209, 25.188],
  11: [2.603, 3.053, 3.816, 4.575, 5.578, 17.275, 19.675, 21.920, 24.725, 26.757],
  12: [3.074, 3.571, 4.404, 5.226, 6.304, 18.549, 21.026, 23.337, 26.217, 28.300],
  13: [3.565, 4.107, 5.009, 5.892, 7.042, 19.812, 22.362, 24.736, 27.688, 29.819],
  14: [4.075, 4.660, 5.629, 6.571, 7.790, 21.064, 23.685, 26.119, 29.141, 31.319],
  15: [4.601, 5.229, 6.262, 7.261, 8.547, 22.307, 24.996, 27.488, 30.578, 32.801],
  16: [5.142, 5.812, 6.908, 7.962, 9.312, 23.542, 26.296, 28.845, 32.000, 34.267],
  17: [5.697, 6.408, 7.564, 8.672, 10.085, 24.769, 27.587, 30.191, 33.409, 35.718],
  18: [6.265, 7.015, 8.231, 9.390, 10.865, 25.989, 28.869, 31.526, 34.805, 37.156],
  19: [6.844, 7.633, 8.907, 10.117, 11.651, 27.204, 30.144, 32.852, 36.191, 38.582],
  20: [7.434, 8.260, 9.591, 10.851, 12.443, 28.412, 31.410, 34.170, 37.566, 39.997],
  21: [8.034, 8.897, 10.283, 11.591, 13.240, 29.615, 32.671, 35.479, 38.932, 41.401],
  22: [8.643, 9.542, 10.982, 12.338, 14.041, 30.813, 33.924, 36.781, 40.289, 42.796],
  23: [9.260, 10.196, 11.689, 13.091, 14.848, 32.007, 35.172, 38.076, 41.638, 44.181],
  24: [9.886, 10.856, 12.401, 13.848, 15.659, 33.196, 36.415, 39.364, 42.980, 45.559],
  25: [10.520, 11.524, 13.120, 14.611, 16.473, 34.382, 37.652, 40.646, 44.314, 46.928],
  26: [11.160, 12.198, 13.844, 15.379, 17.292, 35.563, 38.885, 41.923, 45.642, 48.290],
  27: [11.808, 12.879, 14.573, 16.151, 18.114, 36.741, 40.113, 43.195, 46.963, 49.645],
  28: [12.461, 13.565, 15.308, 16.928, 18.939, 37.916, 41.337, 44.461, 48.278, 50.993],
  29: [13.121, 14.256, 16.047, 17.708, 19.768, 39.087, 42.557, 45.722, 49.588, 52.336],
  30: [13.787, 14.953, 16.791, 18.493, 20.599, 40.256, 43.773, 46.979, 50.892, 53.672],
  40: [20.707, 22.164, 24.433, 26.509, 29.051, 51.805, 55.758, 59.342, 63.691, 66.766],
  50: [27.991, 29.707, 32.357, 34.764, 37.689, 63.167, 67.505, 71.420, 76.154, 79.490],
  60: [35.534, 37.485, 40.482, 43.188, 46.459, 74.397, 79.082, 83.298, 88.379, 91.952],
  70: [43.275, 45.442, 48.758, 51.739, 55.329, 85.527, 90.531, 95.023, 100.425, 104.215],
  80: [51.172, 53.540, 57.153, 60.391, 64.278, 96.578, 101.879, 106.629, 112.329, 116.321],
  90: [59.196, 61.754, 65.647, 69.126, 73.291, 107.565, 113.145, 118.136, 124.116, 128.299],
  100: [67.328, 70.065, 74.222, 77.929, 82.358, 118.498, 124.342, 129.561, 135.807, 140.169],
};

export function lookupChiSquare(df: number, alpha: number): number | null {
  const alphaIndex = CHI_SQUARE_ALPHA.indexOf(alpha as typeof CHI_SQUARE_ALPHA[number]);
  if (alphaIndex === -1) return null;

  let closestDf: number = CHI_SQUARE_DF[0];
  for (const tableDf of CHI_SQUARE_DF) {
    if (tableDf <= df) closestDf = tableDf;
    else break;
  }

  const row = CHI_SQUARE_VALUES[closestDf];
  return row ? row[alphaIndex] : null;
}

export function findClosestChiDf(df: number): number {
  let closest: number = CHI_SQUARE_DF[0];
  for (const tableDf of CHI_SQUARE_DF) {
    if (tableDf <= df) closest = tableDf;
    else break;
  }
  return closest;
}

// F-Distribution Critical Values
// Used in ANOVA and F-tests for comparing variances
export const F_TABLE_DF1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 15, 20, 24, 30, 40, 60, 120] as const;
export const F_TABLE_DF2 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 40, 60, 120, Infinity] as const;

// F-critical values for alpha = 0.05 (right-tail)
// F_CRITICAL_005[df1][df2] = critical value
export const F_CRITICAL_005: Record<number, Record<number, number>> = {
  1: { 1: 161.4, 2: 199.5, 3: 215.7, 4: 224.6, 5: 230.2, 6: 234.0, 7: 236.8, 8: 238.9, 9: 240.5, 10: 241.9, 11: 243.0, 12: 243.9, 13: 244.7, 14: 245.4, 15: 245.9, 16: 246.5, 17: 246.9, 18: 247.3, 19: 247.7, 20: 248.0, 21: 248.3, 22: 248.6, 23: 248.8, 24: 249.1, 25: 249.3, 26: 249.5, 27: 249.6, 28: 249.8, 29: 250.0, 30: 250.1, 40: 251.1, 60: 252.2, 120: 253.3, [Infinity]: 254.3 },
  2: { 1: 18.51, 2: 19.00, 3: 19.16, 4: 19.25, 5: 19.30, 6: 19.33, 7: 19.35, 8: 19.37, 9: 19.38, 10: 19.40, 11: 19.40, 12: 19.41, 13: 19.42, 14: 19.42, 15: 19.43, 16: 19.43, 17: 19.44, 18: 19.44, 19: 19.44, 20: 19.45, 21: 19.45, 22: 19.45, 23: 19.45, 24: 19.45, 25: 19.46, 26: 19.46, 27: 19.46, 28: 19.46, 29: 19.46, 30: 19.46, 40: 19.47, 60: 19.48, 120: 19.49, [Infinity]: 19.50 },
  3: { 1: 10.13, 2: 9.55, 3: 9.28, 4: 9.12, 5: 9.01, 6: 8.94, 7: 8.89, 8: 8.85, 9: 8.81, 10: 8.79, 11: 8.76, 12: 8.74, 13: 8.73, 14: 8.71, 15: 8.70, 16: 8.69, 17: 8.68, 18: 8.67, 19: 8.67, 20: 8.66, 21: 8.65, 22: 8.65, 23: 8.64, 24: 8.64, 25: 8.63, 26: 8.63, 27: 8.63, 28: 8.62, 29: 8.62, 30: 8.62, 40: 8.59, 60: 8.57, 120: 8.55, [Infinity]: 8.53 },
  4: { 1: 7.71, 2: 6.94, 3: 6.59, 4: 6.39, 5: 6.26, 6: 6.16, 7: 6.09, 8: 6.04, 9: 6.00, 10: 5.96, 11: 5.94, 12: 5.91, 13: 5.89, 14: 5.87, 15: 5.86, 16: 5.84, 17: 5.83, 18: 5.82, 19: 5.81, 20: 5.80, 21: 5.79, 22: 5.79, 23: 5.78, 24: 5.77, 25: 5.77, 26: 5.76, 27: 5.76, 28: 5.75, 29: 5.75, 30: 5.75, 40: 5.72, 60: 5.69, 120: 5.66, [Infinity]: 5.63 },
  5: { 1: 6.61, 2: 5.79, 3: 5.41, 4: 5.19, 5: 5.05, 6: 4.95, 7: 4.88, 8: 4.82, 9: 4.77, 10: 4.74, 11: 4.70, 12: 4.68, 13: 4.66, 14: 4.64, 15: 4.62, 16: 4.60, 17: 4.59, 18: 4.58, 19: 4.57, 20: 4.56, 21: 4.55, 22: 4.54, 23: 4.53, 24: 4.53, 25: 4.52, 26: 4.52, 27: 4.51, 28: 4.50, 29: 4.50, 30: 4.50, 40: 4.46, 60: 4.43, 120: 4.40, [Infinity]: 4.36 },
  6: { 1: 5.99, 2: 5.14, 3: 4.76, 4: 4.53, 5: 4.39, 6: 4.28, 7: 4.21, 8: 4.15, 9: 4.10, 10: 4.06, 11: 4.03, 12: 4.00, 13: 3.98, 14: 3.96, 15: 3.94, 16: 3.92, 17: 3.91, 18: 3.90, 19: 3.88, 20: 3.87, 21: 3.86, 22: 3.86, 23: 3.85, 24: 3.84, 25: 3.83, 26: 3.83, 27: 3.82, 28: 3.82, 29: 3.81, 30: 3.81, 40: 3.77, 60: 3.74, 120: 3.70, [Infinity]: 3.67 },
  7: { 1: 5.59, 2: 4.74, 3: 4.35, 4: 4.12, 5: 3.97, 6: 3.87, 7: 3.79, 8: 3.73, 9: 3.68, 10: 3.64, 11: 3.60, 12: 3.57, 13: 3.55, 14: 3.53, 15: 3.51, 16: 3.49, 17: 3.48, 18: 3.47, 19: 3.46, 20: 3.44, 21: 3.43, 22: 3.43, 23: 3.42, 24: 3.41, 25: 3.40, 26: 3.40, 27: 3.39, 28: 3.39, 29: 3.38, 30: 3.38, 40: 3.34, 60: 3.30, 120: 3.27, [Infinity]: 3.23 },
  8: { 1: 5.32, 2: 4.46, 3: 4.07, 4: 3.84, 5: 3.69, 6: 3.58, 7: 3.50, 8: 3.44, 9: 3.39, 10: 3.35, 11: 3.31, 12: 3.28, 13: 3.26, 14: 3.24, 15: 3.22, 16: 3.20, 17: 3.19, 18: 3.17, 19: 3.16, 20: 3.15, 21: 3.14, 22: 3.13, 23: 3.12, 24: 3.12, 25: 3.11, 26: 3.10, 27: 3.10, 28: 3.09, 29: 3.08, 30: 3.08, 40: 3.04, 60: 3.01, 120: 2.97, [Infinity]: 2.93 },
  9: { 1: 5.12, 2: 4.26, 3: 3.86, 4: 3.63, 5: 3.48, 6: 3.37, 7: 3.29, 8: 3.23, 9: 3.18, 10: 3.14, 11: 3.10, 12: 3.07, 13: 3.05, 14: 3.03, 15: 3.01, 16: 2.99, 17: 2.97, 18: 2.96, 19: 2.95, 20: 2.94, 21: 2.93, 22: 2.92, 23: 2.91, 24: 2.90, 25: 2.89, 26: 2.89, 27: 2.88, 28: 2.87, 29: 2.87, 30: 2.86, 40: 2.83, 60: 2.79, 120: 2.75, [Infinity]: 2.71 },
  10: { 1: 4.96, 2: 4.10, 3: 3.71, 4: 3.48, 5: 3.33, 6: 3.22, 7: 3.14, 8: 3.07, 9: 3.02, 10: 2.98, 11: 2.94, 12: 2.91, 13: 2.89, 14: 2.86, 15: 2.85, 16: 2.83, 17: 2.81, 18: 2.80, 19: 2.79, 20: 2.77, 21: 2.76, 22: 2.75, 23: 2.75, 24: 2.74, 25: 2.73, 26: 2.72, 27: 2.72, 28: 2.71, 29: 2.70, 30: 2.70, 40: 2.66, 60: 2.62, 120: 2.58, [Infinity]: 2.54 },
  12: { 1: 4.75, 2: 3.89, 3: 3.49, 4: 3.26, 5: 3.11, 6: 3.00, 7: 2.91, 8: 2.85, 9: 2.80, 10: 2.75, 11: 2.72, 12: 2.69, 13: 2.66, 14: 2.64, 15: 2.62, 16: 2.60, 17: 2.58, 18: 2.57, 19: 2.56, 20: 2.54, 21: 2.53, 22: 2.52, 23: 2.51, 24: 2.51, 25: 2.50, 26: 2.49, 27: 2.48, 28: 2.48, 29: 2.47, 30: 2.47, 40: 2.43, 60: 2.38, 120: 2.34, [Infinity]: 2.30 },
  15: { 1: 4.54, 2: 3.68, 3: 3.29, 4: 3.06, 5: 2.90, 6: 2.79, 7: 2.71, 8: 2.64, 9: 2.59, 10: 2.54, 11: 2.51, 12: 2.48, 13: 2.45, 14: 2.42, 15: 2.40, 16: 2.38, 17: 2.37, 18: 2.35, 19: 2.34, 20: 2.33, 21: 2.32, 22: 2.31, 23: 2.30, 24: 2.29, 25: 2.28, 26: 2.27, 27: 2.27, 28: 2.26, 29: 2.25, 30: 2.25, 40: 2.20, 60: 2.16, 120: 2.11, [Infinity]: 2.07 },
  20: { 1: 4.35, 2: 3.49, 3: 3.10, 4: 2.87, 5: 2.71, 6: 2.60, 7: 2.51, 8: 2.45, 9: 2.39, 10: 2.35, 11: 2.31, 12: 2.28, 13: 2.25, 14: 2.22, 15: 2.20, 16: 2.18, 17: 2.17, 18: 2.15, 19: 2.14, 20: 2.12, 21: 2.11, 22: 2.10, 23: 2.09, 24: 2.08, 25: 2.07, 26: 2.07, 27: 2.06, 28: 2.05, 29: 2.05, 30: 2.04, 40: 1.99, 60: 1.95, 120: 1.90, [Infinity]: 1.84 },
  24: { 1: 4.26, 2: 3.40, 3: 3.01, 4: 2.78, 5: 2.62, 6: 2.51, 7: 2.42, 8: 2.36, 9: 2.30, 10: 2.25, 11: 2.21, 12: 2.18, 13: 2.15, 14: 2.13, 15: 2.11, 16: 2.09, 17: 2.07, 18: 2.05, 19: 2.04, 20: 2.03, 21: 2.01, 22: 2.00, 23: 1.99, 24: 1.98, 25: 1.97, 26: 1.97, 27: 1.96, 28: 1.95, 29: 1.95, 30: 1.94, 40: 1.89, 60: 1.84, 120: 1.79, [Infinity]: 1.73 },
  30: { 1: 4.17, 2: 3.32, 3: 2.92, 4: 2.69, 5: 2.53, 6: 2.42, 7: 2.33, 8: 2.27, 9: 2.21, 10: 2.16, 11: 2.13, 12: 2.09, 13: 2.06, 14: 2.04, 15: 2.01, 16: 1.99, 17: 1.98, 18: 1.96, 19: 1.95, 20: 1.93, 21: 1.92, 22: 1.91, 23: 1.90, 24: 1.89, 25: 1.88, 26: 1.88, 27: 1.87, 28: 1.86, 29: 1.85, 30: 1.85, 40: 1.79, 60: 1.74, 120: 1.68, [Infinity]: 1.62 },
  40: { 1: 4.08, 2: 3.23, 3: 2.84, 4: 2.61, 5: 2.45, 6: 2.34, 7: 2.25, 8: 2.18, 9: 2.12, 10: 2.08, 11: 2.04, 12: 2.00, 13: 1.97, 14: 1.95, 15: 1.92, 16: 1.90, 17: 1.89, 18: 1.87, 19: 1.85, 20: 1.84, 21: 1.83, 22: 1.81, 23: 1.80, 24: 1.79, 25: 1.78, 26: 1.77, 27: 1.77, 28: 1.76, 29: 1.75, 30: 1.74, 40: 1.69, 60: 1.64, 120: 1.58, [Infinity]: 1.51 },
  60: { 1: 4.00, 2: 3.15, 3: 2.76, 4: 2.53, 5: 2.37, 6: 2.25, 7: 2.17, 8: 2.10, 9: 2.04, 10: 1.99, 11: 1.95, 12: 1.92, 13: 1.89, 14: 1.86, 15: 1.84, 16: 1.81, 17: 1.80, 18: 1.78, 19: 1.76, 20: 1.75, 21: 1.73, 22: 1.72, 23: 1.71, 24: 1.70, 25: 1.69, 26: 1.68, 27: 1.67, 28: 1.66, 29: 1.66, 30: 1.65, 40: 1.59, 60: 1.53, 120: 1.47, [Infinity]: 1.39 },
  120: { 1: 3.92, 2: 3.07, 3: 2.68, 4: 2.45, 5: 2.29, 6: 2.18, 7: 2.09, 8: 2.02, 9: 1.96, 10: 1.91, 11: 1.87, 12: 1.83, 13: 1.80, 14: 1.78, 15: 1.75, 16: 1.73, 17: 1.71, 18: 1.69, 19: 1.67, 20: 1.66, 21: 1.64, 22: 1.63, 23: 1.62, 24: 1.61, 25: 1.60, 26: 1.59, 27: 1.58, 28: 1.57, 29: 1.56, 30: 1.55, 40: 1.50, 60: 1.43, 120: 1.35, [Infinity]: 1.25 },
};

// F-critical values for alpha = 0.01 (right-tail)
export const F_CRITICAL_001: Record<number, Record<number, number>> = {
  1: { 1: 4052, 2: 4999, 3: 5403, 4: 5625, 5: 5764, 6: 5859, 7: 5928, 8: 5982, 9: 6022, 10: 6056, 11: 6083, 12: 6106, 13: 6126, 14: 6143, 15: 6157, 16: 6170, 17: 6181, 18: 6191, 19: 6201, 20: 6209, 21: 6216, 22: 6223, 23: 6229, 24: 6235, 25: 6240, 26: 6245, 27: 6250, 28: 6254, 29: 6258, 30: 6261, 40: 6287, 60: 6313, 120: 6339, [Infinity]: 6366 },
  2: { 1: 98.50, 2: 99.00, 3: 99.17, 4: 99.25, 5: 99.30, 6: 99.33, 7: 99.36, 8: 99.37, 9: 99.39, 10: 99.40, 11: 99.41, 12: 99.42, 13: 99.42, 14: 99.43, 15: 99.43, 16: 99.44, 17: 99.44, 18: 99.44, 19: 99.45, 20: 99.45, 21: 99.45, 22: 99.46, 23: 99.46, 24: 99.46, 25: 99.46, 26: 99.46, 27: 99.47, 28: 99.47, 29: 99.47, 30: 99.47, 40: 99.47, 60: 99.48, 120: 99.49, [Infinity]: 99.50 },
  3: { 1: 34.12, 2: 30.82, 3: 29.46, 4: 28.71, 5: 28.24, 6: 27.91, 7: 27.67, 8: 27.49, 9: 27.35, 10: 27.23, 11: 27.13, 12: 27.05, 13: 26.98, 14: 26.92, 15: 26.87, 16: 26.83, 17: 26.79, 18: 26.75, 19: 26.72, 20: 26.69, 21: 26.66, 22: 26.64, 23: 26.62, 24: 26.60, 25: 26.58, 26: 26.56, 27: 26.55, 28: 26.53, 29: 26.52, 30: 26.50, 40: 26.41, 60: 26.32, 120: 26.22, [Infinity]: 26.13 },
  4: { 1: 21.20, 2: 18.00, 3: 16.69, 4: 15.98, 5: 15.52, 6: 15.21, 7: 14.98, 8: 14.80, 9: 14.66, 10: 14.55, 11: 14.45, 12: 14.37, 13: 14.31, 14: 14.25, 15: 14.20, 16: 14.15, 17: 14.11, 18: 14.08, 19: 14.05, 20: 14.02, 21: 13.99, 22: 13.97, 23: 13.95, 24: 13.93, 25: 13.91, 26: 13.89, 27: 13.88, 28: 13.86, 29: 13.85, 30: 13.84, 40: 13.75, 60: 13.65, 120: 13.56, [Infinity]: 13.46 },
  5: { 1: 16.26, 2: 13.27, 3: 12.06, 4: 11.39, 5: 10.97, 6: 10.67, 7: 10.46, 8: 10.29, 9: 10.16, 10: 10.05, 11: 9.96, 12: 9.89, 13: 9.82, 14: 9.77, 15: 9.72, 16: 9.68, 17: 9.64, 18: 9.61, 19: 9.58, 20: 9.55, 21: 9.53, 22: 9.51, 23: 9.49, 24: 9.47, 25: 9.45, 26: 9.43, 27: 9.42, 28: 9.40, 29: 9.39, 30: 9.38, 40: 9.29, 60: 9.20, 120: 9.11, [Infinity]: 9.02 },
  6: { 1: 13.75, 2: 10.92, 3: 9.78, 4: 9.15, 5: 8.75, 6: 8.47, 7: 8.26, 8: 8.10, 9: 7.98, 10: 7.87, 11: 7.79, 12: 7.72, 13: 7.66, 14: 7.60, 15: 7.56, 16: 7.52, 17: 7.48, 18: 7.45, 19: 7.42, 20: 7.40, 21: 7.37, 22: 7.35, 23: 7.33, 24: 7.31, 25: 7.30, 26: 7.28, 27: 7.27, 28: 7.25, 29: 7.24, 30: 7.23, 40: 7.14, 60: 7.06, 120: 6.97, [Infinity]: 6.88 },
  7: { 1: 12.25, 2: 9.55, 3: 8.45, 4: 7.85, 5: 7.46, 6: 7.19, 7: 6.99, 8: 6.84, 9: 6.72, 10: 6.62, 11: 6.54, 12: 6.47, 13: 6.41, 14: 6.36, 15: 6.31, 16: 6.27, 17: 6.24, 18: 6.21, 19: 6.18, 20: 6.16, 21: 6.13, 22: 6.11, 23: 6.09, 24: 6.07, 25: 6.06, 26: 6.04, 27: 6.03, 28: 6.02, 29: 6.00, 30: 5.99, 40: 5.91, 60: 5.82, 120: 5.74, [Infinity]: 5.65 },
  8: { 1: 11.26, 2: 8.65, 3: 7.59, 4: 7.01, 5: 6.63, 6: 6.37, 7: 6.18, 8: 6.03, 9: 5.91, 10: 5.81, 11: 5.73, 12: 5.67, 13: 5.61, 14: 5.56, 15: 5.52, 16: 5.48, 17: 5.44, 18: 5.41, 19: 5.38, 20: 5.36, 21: 5.34, 22: 5.32, 23: 5.30, 24: 5.28, 25: 5.26, 26: 5.25, 27: 5.23, 28: 5.22, 29: 5.21, 30: 5.20, 40: 5.12, 60: 5.03, 120: 4.95, [Infinity]: 4.86 },
  9: { 1: 10.56, 2: 8.02, 3: 6.99, 4: 6.42, 5: 6.06, 6: 5.80, 7: 5.61, 8: 5.47, 9: 5.35, 10: 5.26, 11: 5.18, 12: 5.11, 13: 5.05, 14: 5.01, 15: 4.96, 16: 4.92, 17: 4.89, 18: 4.86, 19: 4.83, 20: 4.81, 21: 4.79, 22: 4.77, 23: 4.75, 24: 4.73, 25: 4.71, 26: 4.70, 27: 4.68, 28: 4.67, 29: 4.66, 30: 4.65, 40: 4.57, 60: 4.48, 120: 4.40, [Infinity]: 4.31 },
  10: { 1: 10.04, 2: 7.56, 3: 6.55, 4: 5.99, 5: 5.64, 6: 5.39, 7: 5.20, 8: 5.06, 9: 4.94, 10: 4.85, 11: 4.77, 12: 4.71, 13: 4.65, 14: 4.60, 15: 4.56, 16: 4.52, 17: 4.49, 18: 4.46, 19: 4.43, 20: 4.41, 21: 4.38, 22: 4.36, 23: 4.34, 24: 4.33, 25: 4.31, 26: 4.30, 27: 4.28, 28: 4.27, 29: 4.26, 30: 4.25, 40: 4.17, 60: 4.08, 120: 4.00, [Infinity]: 3.91 },
  12: { 1: 9.33, 2: 6.93, 3: 5.95, 4: 5.41, 5: 5.06, 6: 4.82, 7: 4.64, 8: 4.50, 9: 4.39, 10: 4.30, 11: 4.22, 12: 4.16, 13: 4.10, 14: 4.05, 15: 4.01, 16: 3.97, 17: 3.94, 18: 3.91, 19: 3.88, 20: 3.86, 21: 3.84, 22: 3.82, 23: 3.80, 24: 3.78, 25: 3.76, 26: 3.75, 27: 3.74, 28: 3.72, 29: 3.71, 30: 3.70, 40: 3.62, 60: 3.54, 120: 3.45, [Infinity]: 3.36 },
  15: { 1: 8.68, 2: 6.36, 3: 5.42, 4: 4.89, 5: 4.56, 6: 4.32, 7: 4.14, 8: 4.00, 9: 3.89, 10: 3.80, 11: 3.73, 12: 3.67, 13: 3.61, 14: 3.56, 15: 3.52, 16: 3.49, 17: 3.45, 18: 3.42, 19: 3.40, 20: 3.37, 21: 3.35, 22: 3.33, 23: 3.31, 24: 3.29, 25: 3.28, 26: 3.26, 27: 3.25, 28: 3.23, 29: 3.22, 30: 3.21, 40: 3.13, 60: 3.05, 120: 2.96, [Infinity]: 2.87 },
  20: { 1: 8.10, 2: 5.85, 3: 4.94, 4: 4.43, 5: 4.10, 6: 3.87, 7: 3.70, 8: 3.56, 9: 3.46, 10: 3.37, 11: 3.29, 12: 3.23, 13: 3.18, 14: 3.13, 15: 3.09, 16: 3.05, 17: 3.02, 18: 2.99, 19: 2.96, 20: 2.94, 21: 2.92, 22: 2.90, 23: 2.88, 24: 2.86, 25: 2.84, 26: 2.83, 27: 2.81, 28: 2.80, 29: 2.79, 30: 2.78, 40: 2.69, 60: 2.61, 120: 2.52, [Infinity]: 2.42 },
  24: { 1: 7.82, 2: 5.61, 3: 4.72, 4: 4.22, 5: 3.90, 6: 3.67, 7: 3.50, 8: 3.36, 9: 3.26, 10: 3.17, 11: 3.09, 12: 3.03, 13: 2.98, 14: 2.93, 15: 2.89, 16: 2.85, 17: 2.82, 18: 2.79, 19: 2.76, 20: 2.74, 21: 2.72, 22: 2.70, 23: 2.68, 24: 2.66, 25: 2.64, 26: 2.63, 27: 2.61, 28: 2.60, 29: 2.59, 30: 2.58, 40: 2.49, 60: 2.40, 120: 2.31, [Infinity]: 2.21 },
  30: { 1: 7.56, 2: 5.39, 3: 4.51, 4: 4.02, 5: 3.70, 6: 3.47, 7: 3.30, 8: 3.17, 9: 3.07, 10: 2.98, 11: 2.91, 12: 2.84, 13: 2.79, 14: 2.74, 15: 2.70, 16: 2.66, 17: 2.63, 18: 2.60, 19: 2.57, 20: 2.55, 21: 2.53, 22: 2.51, 23: 2.49, 24: 2.47, 25: 2.45, 26: 2.44, 27: 2.42, 28: 2.41, 29: 2.40, 30: 2.39, 40: 2.30, 60: 2.21, 120: 2.11, [Infinity]: 2.01 },
  40: { 1: 7.31, 2: 5.18, 3: 4.31, 4: 3.83, 5: 3.51, 6: 3.29, 7: 3.12, 8: 2.99, 9: 2.89, 10: 2.80, 11: 2.73, 12: 2.66, 13: 2.61, 14: 2.56, 15: 2.52, 16: 2.49, 17: 2.45, 18: 2.42, 19: 2.40, 20: 2.37, 21: 2.35, 22: 2.33, 23: 2.31, 24: 2.29, 25: 2.27, 26: 2.26, 27: 2.24, 28: 2.23, 29: 2.22, 30: 2.20, 40: 2.11, 60: 2.02, 120: 1.92, [Infinity]: 1.80 },
  60: { 1: 7.08, 2: 4.98, 3: 4.13, 4: 3.65, 5: 3.34, 6: 3.12, 7: 2.95, 8: 2.82, 9: 2.72, 10: 2.63, 11: 2.56, 12: 2.50, 13: 2.45, 14: 2.40, 15: 2.35, 16: 2.32, 17: 2.28, 18: 2.25, 19: 2.22, 20: 2.20, 21: 2.17, 22: 2.15, 23: 2.13, 24: 2.12, 25: 2.10, 26: 2.08, 27: 2.07, 28: 2.05, 29: 2.04, 30: 2.03, 40: 1.94, 60: 1.84, 120: 1.73, [Infinity]: 1.60 },
  120: { 1: 6.85, 2: 4.79, 3: 3.95, 4: 3.48, 5: 3.17, 6: 2.96, 7: 2.79, 8: 2.66, 9: 2.56, 10: 2.47, 11: 2.40, 12: 2.34, 13: 2.28, 14: 2.23, 15: 2.19, 16: 2.15, 17: 2.12, 18: 2.09, 19: 2.06, 20: 2.03, 21: 2.01, 22: 1.99, 23: 1.97, 24: 1.95, 25: 1.93, 26: 1.92, 27: 1.90, 28: 1.88, 29: 1.87, 30: 1.86, 40: 1.76, 60: 1.66, 120: 1.53, [Infinity]: 1.38 },
};

export function lookupFValue(df1: number, df2: number, alpha: number = 0.05): number | null {
  const table = alpha === 0.01 ? F_CRITICAL_001 : F_CRITICAL_005;

  // Find closest df1 (Inner Key)
  let closestDf1: number = F_TABLE_DF1[0];
  for (const d of F_TABLE_DF1) {
    if (d <= df1) closestDf1 = d;
    else break;
  }

  // Find closest df2 (Outer Key)
  let closestDf2: number = F_TABLE_DF2[0];
  for (const d of F_TABLE_DF2) {
    if (d === Infinity) {
      if (df2 >= 120) closestDf2 = Infinity;
      break;
    }
    if (d <= df2) closestDf2 = d;
    else break;
  }

  const row = table[closestDf2];
  if (!row) return null;
  return row[closestDf1] ?? null;
}

export function findClosestFDf1(df: number): number {
  let closest: number = F_TABLE_DF1[0];
  for (const tableDf of F_TABLE_DF1) {
    if (tableDf <= df) closest = tableDf;
    else break;
  }
  return closest;
}

export function findClosestFDf2(df: number): number {
  let closest: number = F_TABLE_DF2[0];
  for (const tableDf of F_TABLE_DF2) {
    if (tableDf === Infinity) {
      if (df >= 120) return Infinity;
      break;
    }
    if (tableDf <= df) closest = tableDf;
    else break;
  }
  return closest;
}
